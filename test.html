<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"/>
  <script type="text/javascript" src="//ebrosh.github.io/store-simulator/js/cdstorage.js"/>
</head>
<body>
<h1>Persistency test!</h1>
<div id="result">
Checking...
</div>

<script type="text/javascript">

// Feature test
var hasStorage = (function() {
  try {
    localStorage.setItem("somekey", "somevalue");
    localStorage.removeItem("somekey");
    return true;
  } catch (exception) {
    return false;
  }
}());

function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
}

function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    }
    return "";
}

function visitCounter() {
    if (hasStorage) {
        if (localStorage.visitCounter) {
            localStorage.visitCounter = Number(localStorage.visitCounter)+1;
        } else {
            localStorage.visitCounter = 1;
        }
		return localStorage.visitCounter;
	}
}

function cookieVisitCounter() {
	var cVisitCount = getCookie("visits");
	var counter;
	if (cVisitCount != null && cVisitCount != "") {
		counter = Number(cVisitCount) + 1;
	} else {
		counter = 1;
	}
	setCookie("visits", counter, 365);
	return counter;
}

function writeText(text) {
	var element = document.getElementById("result");
	var newHTML = element.innerHTML + "<br/>" + text;
	element.innerHTML = newHTML;
}

if (hasStorage) {
	writeText("storage supported.");
	var visits = visitCounter();
	writeText("You have visited " + visits + " time(s)");
} else {
	writeText("No Local storage supportd found!");
}

writeText("checking cookie persistency...");
var cvisits = cookieVisitCounter();
writeText("According to Cookies you have visited " + cvisits + " time(s)");
writeText("Done.");




</script>


</body>
</html>
